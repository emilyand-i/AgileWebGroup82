<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Plant Growth Tracker (By Plant)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/displayDataStyle.css">
</head>
<body>
  <a class="btn btn-success btn-lg mt-3 add_stat" href="dashboard.html">
    <i class="bi bi-plus-circle me-2"></i> Back to Dashboard
  </a> 

  <div class="container py-5">

    <h1 class="mb-4">Plant Growth Tracker</h1>

    <form id="growthForm" class="row g-3">
      <div class="col-md-3">
        <input type="text" id="plantName" class="form-control" placeholder="Plant Name (8 letters)" required maxlength="8">
      </div>
      <div class="col-md-3">
        <input type="date" id="plantDate" class="form-control" required>
      </div>
      <div class="col-md-3">
        <input type="number" id="plantHeight" class="form-control" placeholder="Height (cm)" required>
      </div>
      <div class="col-md-3 d-grid">
        <button type="submit" class="btn btn-primary">Add Data</button>
      </div>
    </form>

    <div class="mt-4">
      <label for="plantSelector" class="form-label">What Plant's Stats are you viewing?</label>
      <select id="plantSelector" class="form-select">
        <option value="">-- Choose a Plant --</option>
      </select>
    </div>
    
    
    <canvas id="graphCanvas" width="1200" height="500"></canvas>
  </div>
</body>

  

  <script>

    // JavaScript for the Plant Growth Tracker
    const form = document.getElementById('growthForm');
    const canvas = document.getElementById('graphCanvas');
    const ctx = canvas.getContext('2d');
    const plantSelector = document.getElementById('plantSelector');

    function addToDropdown(name) {
      // Make new option for the plant in the dropdown menu
      const option = document.createElement('option');
      option.value = name;
      option.textContent = name;
      plantSelector.appendChild(option);
    }

    plantSelector.addEventListener('change', () => {
      const selectedPlant = plantSelector.value;
      if (selectedPlant) {
        drawGraph(selectedPlant);
      } else {
        // Clear the canvas if no plant is selected
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }
    });

    const plantData = {}; 
    // Store plant data in an object; Keys are plant names, values are arrays of dates & growth 
    // Example: { Plant42: [{date: ..., height: ...}], Bulbasaur: [...] }

    form.addEventListener('submit', (e) => {
      e.preventDefault();

      const name = document.getElementById('plantName').value.trim();
      const date = document.getElementById('plantDate').value;
      const height = parseFloat(document.getElementById('plantHeight').value);

      //Don't add data if any field is empty or invalid
      if (!name || !date || isNaN(height)) return;
      
      // Create a new entry for the plant if it doesn't exist
      if (!plantData[name]) {
        plantData[name] = [];
        addToDropdown(name);
      }

      // Add the new info to plant's data array
      plantData[name].push({ date, height });

      // Sort the data by date
      // Therefore if older data is added, graph will still be correct
      plantData[name].sort((a, b) => new Date(a.date) - new Date(b.date));

      form.reset();
      if (plantSelector.value === name) {
        drawGraph(name); // Redraw if it's currently selected by our user
      }
    });

    
    function drawGraph(plantName) {
      const data = plantData[plantName];

      // we can only draw the graph if we have at least 2 data points
      if (!data || data.length < 2) return;

      // Clear current canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const padding = 70;
      const graphWidth = canvas.width - padding * 2;
      const graphHeight = canvas.height - padding * 2;

      const dates = data.map(d => new Date(d.date));
      const heights = data.map(d => d.height);


      // scale our graph based on the min and max values of our data
      const minDate = Math.min(...dates.map(d => d.getTime()));
      const maxDate = Math.max(...dates.map(d => d.getTime()));
      const minHeight = Math.min(...heights);
      const maxHeight = Math.max(...heights);

      function getX(date) {
        return padding + ((date.getTime() - minDate) / (maxDate - minDate)) * graphWidth;
      }

      function getY(height) {
        return canvas.height - padding - ((height - minHeight) / (maxHeight - minHeight)) * graphHeight;
      }

      ctx.beginPath();
      ctx.moveTo(padding, padding);
      ctx.lineTo(padding, canvas.height - padding); //draw y-axis
      ctx.lineTo(canvas.width - padding, canvas.height - padding); //draw x-axis
      ctx.stroke(); //apply these lines to canvas

      // Plot points and connect them
      ctx.beginPath();
      ctx.strokeStyle = '#28a745';
      ctx.lineWidth = 4;
      data.forEach((point, index) => {
        const x = getX(new Date(point.date));
        const y = getY(point.height);

        if (index === 0){
          ctx.moveTo(x, y);
        }
        else {
          ctx.lineTo(x, y);
        }

        ctx.arc(x, y, 5, 0, 2 * Math.PI); // Draw point
      });
      ctx.stroke();

      // Y-Axis label
      ctx.save(); // Save current state
      ctx.translate(20, canvas.height / 2);
      ctx.rotate(-Math.PI / 2);
      ctx.textAlign = "center";
      ctx.font = "14px sans-serif";
      ctx.fillText("Height Grown", 0, 0);
      ctx.restore(); // Restore back to normal

      // X-Axis label
      ctx.font = "14px sans-serif";
      ctx.textAlign = "center";
      ctx.fillText("Time Spent Growing", canvas.width / 2, canvas.height - 10);

      // Write Title linked to the plant name
      ctx.font = "bold 18px sans-serif";
      ctx.fillText(`${plantName}'s Growth Journey`, canvas.width / 2, padding - 15);
    }
  </script>
</body>
</html>



